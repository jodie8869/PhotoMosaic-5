<!DOCTYPE HTML>

<html>

<head>
	<meta charset="UTF-8" />
	<title>Choose Pictures</title>

	<link type="text/css" rel="stylesheet" href="./css/reset.css" />
	<link type="text/css" rel="stylesheet" href="./css/select.css" />
</head>

<body>

<!-- HEADER -->
<header class="header">
	<div class="logo">서비스 로고</div>
	<div class="user">유저 정보</div>
</header>

<!-- SELECT PICTURES -->
<section class="select">
<div class="positioner">
	<article class="contents">
		<header>
			<section>
				<input type="text" name="title" placeholder="Title" />
			</section>
			<section>
				<input type="text" name="subtitle" placeholder="Subtitle"/>
			</section>
		</header>
		<article class="pictures">
		<div class="positioner">
			선택된 사진들이 표시됨
		</div>
		</article>
	</article>
	<section class="controll">
		<input type="file" name="pictures" multiple accept="image/*" />
		<button>Upload</button>
	</section >
</div>
</section>

<script src="script/util.js"></script>
<script>
	// Check File APIs are available
	if (window.File
			&& window.FileList
			&& window.FileReader
			&& window.Blob) {
		window.images = [];
		initialize();
	} else {
		// Browser 버전과 지원사항에 대한 안내 보내기
	}

	// initialize
	function initialize() {
		var eleInput = document.querySelector(".controll > input");
		var eleDrag = document.querySelector(".pictures > .positioner");

		// file select
		eleInput.addEventListener("change", FileSelectHandler, false);

		// is XHR2 available?
		var xhr = new XMLHttpRequest();

		if (xhr.upload) {
			// file drop
			eleDrag.addEventListener("dragover", FileDragHover, false);
			eleDrag.addEventListener("dragleave", FileDragHover, false);
			eleDrag.addEventListener("drop", FileSelectHandler, false);
		}
	}

	// file drag hover
	function FileDragHover(event) {
		event.stopPropagation();
		event.preventDefault();

		if (event.type == "dragover") {
			event.dataTransfer.dropEffect = "copy"; 
			event.target.appendClassName("hover");
		} else {
			event.target.removeClassName("hover");
		}
	}

	// file selection
	function FileSelectHandler(event) {
		// cancel event and hover styling
		FileDragHover(event);

		// fetch FileList object
		var files = event.target.files || event.dataTransfer.files;

		// process all File objects
		for (var i = 0, f; f = files[i]; i++) {
			console.log("hihi");

			// Only process image files.
			if (!f.type.match('image.*')) {
				continue;
			}

			window.images.push(f);

			var reader = new FileReader();

			// Closure to capture the file information.
			reader.onload = (function(theFile) {
				return function(event) {
					// Render thumbnail.
					var span = document.createElement('span');
					span.innerHTML = ['<img class="thumb" src="', event.target.result,
					'" title="', escape(theFile.name), '"/>'].join('');

					document.querySelector(".pictures .positioner").insertBefore(span, null);
				};
			})(f);

			// Read in the image file as a data URL.
			reader.readAsDataURL(f);
		}
	}

</script>

</body>

</html>
